#!/bin/bash
cd /home/pi/security/
function readConf {
shopt -s extglob
while IFS='= ' read lhs rhs
do
    if [[ $line != *( )#* ]]
    then
        # you can test for variables to accept or other conditions here
        declare -g $lhs=$rhs
    fi
done < security.conf
}

function checkStatus {
if [ "$1" = "open" ]
then
sleep 5
alarm=`./checkHostStatus`
manualOverride=auto
if [ "$manualOverride" = "true" ] || [ "$manualOverride$alarm" = "autofalse" ] 
then
message="$2 is $1 and the alarm is on"
echo $message
echo `date`
./sendGtalk "$message"
fi
fi
}

#start of program
echo "Starting program " . `date`
gpio export 0 in
gpio export 1 in
gpio export 15 in
while(true)
do
#checkStatus BackDoor
backDoorStatus=`./checkStatusDoor 15`
garageDoorStatus=`./checkStatusDoor 0`
frontDoorStatus=`./checkStatusDoor 1`

checkStatus $backDoorStatus "Back Door"
checkStatus $garageDoorStatus "Garage Door"
checkStatus $frontDoorStatus "Front Door"

#sleep for a second
sleep 2
done

